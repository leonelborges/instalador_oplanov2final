listeners.tcp.default = 5672

# TCP socket options for high-performance chat application
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.exit_on_close = false
tcp_listen_options.keepalive = true

# Optimized for high concurrency (WhatsApp + Socket.io + Bull queues)
channel_max = 2047
handshake_timeout = 10000
heartbeat = 60

# Memory threshold
vm_memory_high_watermark.relative = 0.7
vm_memory_calculation_strategy = rss

# Ensure at least 50MB free disk space
disk_free_limit.absolute = 50MB

# Maximum message size
max_message_size = 16777216

# Queue index optimization for message embedding
queue_index_embed_msgs_below = 4096

# Enable statistics collection for management UI
collect_statistics = coarse
collect_statistics_interval = 5000

# Management plugin cache multiplier
management.db_cache_multiplier = 5

# clustering (prepared for future scaling)
cluster_name = whaticket-chat
cluster_partition_handling = ignore
cluster_keepalive_interval = 10000

# logging
log.file.level = info

# Disable reverse DNS lookups
reverse_dns_lookups = false

# Default mechanisms suitable for applications
auth_mechanisms.1 = PLAIN
auth_mechanisms.2 = AMQPLAIN

# default virtual host and user
default_vhost = /
default_user = ${RABBIT_USER}
default_pass = ${RABBIT_PASS}
default_user_tags.administrator = true

# Default permissions
default_permissions.configure = .*
default_permissions.read = .*
default_permissions.write = .*

# Number of delegate processes for intra-cluster communication
delegate_count = 16

# Leader locator strategy for new queues
queue_leader_locator = client-local